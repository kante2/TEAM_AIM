# Mission 1-1: κΈ°λ³Έ μ£Όν–‰ μ μ–΄ (Basic Vehicle Trajectory Tracking)

## π“‹ κ°μ”

**Mission 1-1**μ€ λ‹¨μΌ μλ™μ£Όν–‰ μ°¨λ‰(CAV, Connected Autonomous Vehicle)μ΄ μ‚¬μ „ μ •μλ κ²½λ΅λ¥Ό λ”°λΌ μ•μ •μ μΌλ΅ μ£Όν–‰ν•λ” κΈ°λ³Έ λ―Έμ…μ…λ‹λ‹¤. Pure Pursuit μ•κ³ λ¦¬μ¦μ„ κΈ°λ°μΌλ΅ κ²½λ΅ μ¶”μ  μ μ–΄λ¥Ό μν–‰ν•λ©°, 5λ°”ν€΄ μ£Όν–‰μ„ μ™„λ£ν•λ” κ²ƒμ„ λ©ν‘λ΅ ν•©λ‹λ‹¤.

---

## π― λ―Έμ… λ©ν‘

- **κ²½λ΅ μ¶”μ **: μ „μ—­ κ²½λ΅(CSV νμΌ)λ¥Ό λ”°λΌ μ •ν™•ν•κ² μ£Όν–‰
- **μ†λ„ μ μ–΄**: μ§μ„  κµ¬κ°„μ€ 2.0 m/s, μ»¤λΈ κµ¬κ°„μ€ 1.7 m/sλ΅ μλ™ μ΅°μ •
- **μ™„μ£Ό κ°μ§€**: 5λ°”ν€΄ μ£Όν–‰ μ™„λ£ μΈμ‹ λ° μ •μ§€
- **Red Flag λ€μ‘**: νƒ€μ›λ΅λ¶€ν„°μ μ •μ§€ μ‹ νΈ(Red Flag)μ— μ¦‰μ‹ λ°μ‘

---

## π—οΈ μ£Όμ” κµ¬μ΅°

### π“ νμΌ κµ¬μ„±
```
mission_1_1/
β”β”€β”€ CMakeLists.txt           # CMake λΉλ“ μ„¤μ •
β”β”€β”€ package.xml              # ROS2 ν¨ν‚¤μ§€ λ©”νƒ€λ°μ΄ν„°
β””β”€β”€ src/
    β””β”€β”€ control_cav_mission_1_1.cpp  # μ£Όμ” μ μ–΄ λ΅μ§
```

### π“¦ ROS2 λ…Έλ“

#### `control_cav_mission_1_1` λ…Έλ“
μλ™μ£Όν–‰ μ°¨λ‰μ μ£Όν–‰ μ μ–΄λ¥Ό λ‹΄λ‹Ήν•λ” λ©”μΈ λ…Έλ“μ…λ‹λ‹¤.

---

## π”§ ν•µμ‹¬ κΈ°λ¥

### 1οΈβƒ£ **κ²½λ΅ λ΅λ”© λ° κ΄€λ¦¬**
- **κ²½λ΅ νμΌ**: `/root/TEAM_AIM/src/global_path/path_mission1_01.csv`
- **ν¬λ§·**: `x, y` μΆν‘ μμ CSV νμΌ
- **κΈ°λ¥**: μ°¨λ‰μ΄ λ”°λΌμ•Ό ν•  μ›¨μ΄ν¬μΈνΈ μ‹ν€€μ¤

```cpp
struct integrate_path_struct {
  double x;
  double y;
};
static std::vector<integrate_path_struct> integrate_path_vector;
```

### 2οΈβƒ£ **Pure Pursuit κ²½λ΅ μ¶”μ  μ μ–΄**

Pure Pursuitμ€ ν„μ¬ μ„μΉμ—μ„ μΌμ •ν• κ±°λ¦¬(Look-Ahead Distance, `Ld`) μ•μ μ›¨μ΄ν¬μΈνΈλ¥Ό λ©ν‘λ΅ ν•μ—¬ μ΅°ν–¥ λ…λ Ήμ„ κ³„μ‚°ν•©λ‹λ‹¤.

**μ£Όμ” νλΌλ―Έν„°:**
- **`speed_mps`**: κΈ°λ³Έ μ†λ„ (κΈ°λ³Έκ°’: 0.5 m/s)
- **`lookahead_m`**: μ„ ν–‰κ±°λ¦¬ (κΈ°λ³Έκ°’: 0.3 m)
- **`max_yaw_rate`**: μµλ€ νμ „ μ†λ„ (κΈ°λ³Έκ°’: 5.5 rad/s)

**λ™μ  μ„ ν–‰κ±°λ¦¬ κ³„μ‚° (`GetLd` ν•¨μ):**
```cpp
double gain_ld = 0.4;          // μ†λ„ κ²μΈ
double max_ld  = 0.355;        // μµλ€ μ„ ν–‰κ±°λ¦¬
double min_ld  = 0.15;         // μµμ† μ„ ν–‰κ±°λ¦¬
double ld = gain_ld * velocity;
```

### 3οΈβƒ£ **μ†λ„ κ³„ν (Velocity Planning)**

μ½”λ„ κ°μ§€λ¥Ό ν†µν•΄ μ†λ„λ¥Ό λ™μ μΌλ΅ μ΅°μ •ν•©λ‹λ‹¤:
- **μ§μ„  κµ¬κ°„**: 2.0 m/s (λΉ λ¥Έ μ£Όν–‰)
- **μ»¤λΈ κµ¬κ°„**: 1.7 m/s (μ•μ •μ  νμ „)

```cpp
bool isCorner(const vector<integrate_path_struct>& path, double L_d, int closest_idx) {
  // λ―Έλ 20κ° μ›¨μ΄ν¬μΈνΈ μ•μ κ°λ„ λ³€ν™”λ¥Ό κ°μ§€
  // 10λ„ μ΄μƒμ κ°λ„ λ³€ν™”κ°€ κ°μ§€λλ©΄ μ»¤λΈλ΅ νλ‹¨
  double threshold_deg = 10.0;
}
```

### 4οΈβƒ£ **μ£Όν–‰ μ™„μ£Ό κ°μ§€ (Lap/Finish Logic)**

μ°¨λ‰μ΄ μ‹μ‘μ  μ£Όλ³€μ— λμ•„μ¬ λ•λ§λ‹¤ LAP μΉ΄μ΄νΈλ¥Ό μ¦κ°€μ‹ν‚µλ‹λ‹¤:

```cpp
struct CavState {
  int id;                 // CAV ID
  double start_x, start_y;  // μ‹μ‘μ 
  int current_lap;        // ν„μ¬ λ© (0~5)
  bool is_initialized;    // μ΄κΈ°ν™” μ—¬λ¶€
  bool is_in_zone;        // μ‹μ‘μ  μμ—­ λ‚΄ μ—¬λ¶€
  bool finished;          // μ™„μ£Ό μ—¬λ¶€ (5λ© λ‹¬μ„±)
};
```

- μ°¨λ‰μ΄ μ‹μ‘μ μΌλ΅λ¶€ν„° 0.1m μ΄λ‚΄λ΅ μ§„μ…ν•λ©΄ **LAP μ¦κ°€**
- 5λ°”ν€΄ μ™„λ£ ν›„ **μλ™ μ •μ§€**

### 5οΈβƒ£ **Red Flag λ€μ‘**

νƒ€μ›(μ μ–΄ μ„Όν„°)λ΅λ¶€ν„°μ μ •μ§€ μ‹ νΈμ— μ¦‰μ‹ λ°μ‘:

```
Red Flag = 1: λ¨λ“  λ…λ Ή μ •μ§€ (μ„ μ†λ„ = 0, κ°μ†λ„ = 0)
Red Flag = 0: μ •μƒ μ μ–΄ λ΅μ§ μ‹¤ν–‰
```

---

## π“΅ ROS2 ν† ν”½

### κµ¬λ…(Subscription)
| ν† ν”½λ… | λ©”μ‹μ§€ νƒ€μ… | μ„¤λ… |
|--------|-----------|------|
| `/CAV_01` | `geometry_msgs/msg/PoseStamped` | μ°¨λ‰μ μμ‹ μ μ„μΉ/μμ„Έ μ •λ³΄ |
| `/CAV_01_RED_FLAG` | `std_msgs/msg/Int32` | νƒ€μ›μ μ •μ§€ μ‹ νΈ |
| `/CAV_01_target_vel` | `std_msgs/msg/Float64` | νƒ€μ›μ λ©ν‘ μ†λ„ λ…λ Ή (μμ: νƒ€μ› λ¨λ“ ν•΄μ ) |

### λ°ν–‰(Publication)
| ν† ν”½λ… | λ©”μ‹μ§€ νƒ€μ… | μ„¤λ… |
|--------|-----------|------|
| `/CAV_01_accel` | `geometry_msgs/msg/Accel` | κ³„μ‚°λ μ„ μ†λ„ λ° κ°μ†λ„ λ…λ Ή |
| `/cmd_vel` | `geometry_msgs/msg/Twist` | μ°¨λ‰ μ†λ„ λ…λ Ή (μ„ μ†λ„ + κ°μ†λ„) |

---

## π€ νλΌλ―Έν„°

λ…Έλ“ μ‹¤ν–‰ μ‹ μ•„λ νλΌλ―Έν„°λ΅ μ μ–΄ μ„±λ¥μ„ νλ‹ν•  μ μμµλ‹λ‹¤:

```bash
ros2 run mission_1_1 control_cav_mission_1_1 \
  --ros-args \
  -p speed_mps:=2.0 \
  -p lookahead_m:=0.4 \
  -p max_yaw_rate:=5.5
```

| νλΌλ―Έν„° | κΈ°λ³Έκ°’ | λ²”μ„ | μ„¤λ… |
|---------|--------|------|------|
| `speed_mps` | 0.5 | 0.1~5.0 | κΈ°λ³Έ μ£Όν–‰ μ†λ„ (m/s) |
| `lookahead_m` | 0.4 | 0.1~1.0 | Pure Pursuit μ„ ν–‰κ±°λ¦¬ (m) |
| `max_yaw_rate` | 5.5 | 1.0~10.0 | μµλ€ νμ „ μ†λ„ μ ν• (rad/s) |
| `cav_id` | 1 | 1~99 | CAVμ μ°¨λ‰ ID |

---

## π’» λΉλ“ λ° μ‹¤ν–‰

### λΉλ“
```bash
cd /root/TEAM_AIM
colcon build --packages-select mission_1_1
source install/setup.bash
```

### μ‹¤ν–‰ (μ‹λ®¬λ μ΄ν„°μ™€ ν•¨κ»)
```bash
# ν„°λ―Έλ„ 1: μ‹λ®¬λ μ΄ν„° μ‹¤ν–‰
ros2 launch simulator_launch simulator.launch.py

# ν„°λ―Έλ„ 2: Mission 1-1 λ…Έλ“ μ‹¤ν–‰
ros2 run mission_1_1 control_cav_mission_1_1
```

### ν™κ²½ λ³€μλ΅ CAV ID μ„¤μ •
```bash
export CAV_ID=1
ros2 run mission_1_1 control_cav_mission_1_1
```

---

## π“ μ μ–΄ νλ¦„λ„

```
1. μ΄κΈ°ν™”
   β”β”€ κ²½λ΅ CSV λ΅λ”©
   β”β”€ μ‹μ‘μ  μ„¤μ •
   β””β”€ ROS2 Pub/Sub μ„¤μ •

2. λ©”μΈ λ£¨ν”„ (100 Hz)
   β”β”€ ν„μ¬ μ„μΉ/μμ„Έ μμ‹ 
   β”β”€ LAP μƒνƒ μ—…λ°μ΄νΈ
   β”β”€ ν„μ¬ μ„μΉμ—μ„ κ°€μ¥ κ°€κΉμ΄ μ›¨μ΄ν¬μΈνΈ μ°ΎκΈ°
   β”β”€ μ»¤λ„ κ²€μ§€ λ° μ†λ„ κ³„ν
   β”β”€ Pure Pursuit κ³„μ‚°
   β”‚  β”β”€ μ„ ν–‰κ±°λ¦¬(Ld) λ™μ  κ³„μ‚°
   β”‚  β”β”€ λ©ν‘ μ›¨μ΄ν¬μΈνΈ νƒμƒ‰
   β”‚  β””β”€ κ³΅λ¥ (kappa) κ³„μ‚° β†’ κ°μ†λ„(wz) λ³€ν™
   β”β”€ Red Flag ν™•μΈ ν›„ λ…λ Ή μƒμ„±
   β””β”€ μ†λ„ λ° νμ „ λ…λ Ή λ°ν–‰

3. μΆ…λ£
   β”β”€ 5LAP μ™„μ£Ό κ°μ§€
   β””β”€ μ •μ§€ λ…λ Ή μ μ§€
```

---

## π” μ£Όμ” ν•¨μ μ„¤λ…

### `findClosestPoint()`
ν„μ¬ μ„μΉμ—μ„ κ²½λ΅ μƒμ κ°€μ¥ κ°€κΉμ΄ μ›¨μ΄ν¬μΈνΈ μΈλ±μ¤λ¥Ό λ°ν™ν•©λ‹λ‹¤.

### `findWaypoint()`
ν„μ¬ μ„μΉλ΅λ¶€ν„° μ„ ν–‰κ±°λ¦¬(Ld) μ΄μƒ λ–¨μ–΄μ§„ μ²« λ²μ§Έ μ›¨μ΄ν¬μΈνΈλ¥Ό μ°Ύμµλ‹λ‹¤.

### `isCorner()`
ν–¥ν›„ 20κ° μ›¨μ΄ν¬μΈνΈμ κ°λ„ λ³€ν™”λ¥Ό λ¶„μ„ν•μ—¬ μ»¤λ„ μ—¬λ¶€λ¥Ό νλ‹¨ν•©λ‹λ‹¤.

### `GetLd()`
ν„μ¬ μ†λ„λ¥Ό κΈ°λ°μΌλ΅ Pure Pursuitμ μ„ ν–‰κ±°λ¦¬λ¥Ό λ™μ μΌλ΅ κ³„μ‚°ν•©λ‹λ‹¤.

### `PoseCallbackForLap()`
LAP μΉ΄μ΄ν… λ΅μ§μ„ κ΄€λ¦¬ν•©λ‹λ‹¤.

---

## β™οΈ νλ‹ κ°€μ΄λ“

### κ²½λ΅ μ¶”μ μ΄ μ§„λ™ν•λ” κ²½μ°
- **λ¬Έμ **: `max_yaw_rate` κ°’μ΄ λ„λ¬΄ νΌ
- **ν•΄κ²°**: `max_yaw_rate`λ¥Ό 3.0 ~ 4.0μΌλ΅ λ‚®μ¶¤

### κ²½λ΅λ¥Ό λ» λ”°λΌκ°€λ” κ²½μ°
- **λ¬Έμ **: `lookahead_m`μ΄ λ„λ¬΄ ν¬κ±°λ‚ μ‘μ
- **ν•΄κ²°**: `lookahead_m`μ„ 0.3 ~ 0.5 λ²”μ„λ΅ μ΅°μ •

### μ»¤λΈμ—μ„ μ†λ„κ°€ λ¶€μ΅±ν• κ²½μ°
- **λ¬Έμ **: μ†λ„ κ³„νμ μ»¤λΈ μ†λ„(1.7 m/s)κ°€ κ³Όλ„ν•κ² λ‚®μ
- **ν•΄κ²°**: `planVelocity()` ν•¨μμ—μ„ μ†λ„ κ°’ μ΅°μ •

---

## π“ μ£Όμ„ λ° μ½”λ“ λ¶„μ„

### Pure Pursuit ν•µμ‹¬ μμ‹
```
kappa = (2 * sin(heading_error)) / lookahead_distance
angular_velocity = linear_velocity * kappa
```

μ—¬κΈ°μ„:
- `heading_error`: μ°¨λ‰κ³Ό λ©ν‘ μ›¨μ΄ν¬μΈνΈ κ°„μ κ°λ„ μ¤μ°¨
- `lookahead_distance`: Pure Pursuitμ μ„ ν–‰κ±°λ¦¬
- `angular_velocity`: κ³„μ‚°λ νμ „ μ†λ„ (rad/s)

---

## π“ κ΄€λ ¨ ROS2 μμ΅΄μ„±

```xml
<build_depend>rclcpp</build_depend>
<build_depend>geometry_msgs</build_depend>
<build_depend>std_msgs</build_depend>
<build_depend>tf2</build_depend>
```

---

## π› λ¬Έμ  ν•΄κ²°

| λ¬Έμ  | μ›μΈ | ν•΄κ²°μ±… |
|------|------|--------|
| κ²½λ΅ νμΌ λ΅λ“ μ‹¤ν¨ | κ²½λ΅ CSV νμΌ μ—†μ | `/root/TEAM_AIM/src/global_path/` ν™•μΈ |
| μ°¨λ‰μ΄ μ›€μ§μ΄μ§€ μ•μ | μ‹λ®¬λ μ΄ν„° λ―Έμ‹¤ν–‰ λλ” ν† ν”½ μ¤λ¥ | `ros2 topic list` ν™•μΈ |
| κ³Όλ„ν• νμ „ | `max_yaw_rate` κ³Όλ€ | κ°’ κ°μ† |
| κ²½λ΅ μ¶”μ  μ¤μ°¨ νΌ | `lookahead_m` λ¶€μ μ  | 0.3~0.5 λ²”μ„λ΅ μ΅°μ • |

---

## π“„ λΌμ΄μ„ μ¤ λ° μ €μ‘κ¶

TEAM AIM ν”„λ΅μ νΈμ μΌλ¶€μ…λ‹λ‹¤.

---

## π‘¥ κΈ°μ—¬μ

- KAIST μμ¨μ£Όν–‰ ν€

---

*Last Updated: 2026-02-02*
